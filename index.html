<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BLUE FAUN ALCHEMIST ‚Äî Player Select</title>

  <style>
    :root{
      --bg0:#05060c;
      --bg1:#0a0f22;
      --ink:#cfe9ff;
      --muted:#86a3c9;
      --glow:#55d6ff;
      --glow2:#8b5cff;
      --danger:#ff4a8d;
      --card:#0b1126cc;
      --line:#2a3a66;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{
      background: radial-gradient(1200px 800px at 50% 35%, #0b1433 0%, #05060c 55%, #02030a 100%);
      color:var(--ink);
      overflow:hidden;
    }

    /* Background layers */
    #bgWrap{position:fixed;inset:0;z-index:0;overflow:hidden;}
    #bgVideo{
      position:absolute;inset:0;width:100%;height:100%;object-fit:cover;
      filter:saturate(1.05) contrast(1.05);
      opacity:.4;
      display:none;
    }
    #bgImg{
      position:absolute;inset:0;
      background-image:
        radial-gradient(1200px 900px at 50% 40%, rgba(85,214,255,.12) 0%, rgba(139,92,255,.05) 35%, rgba(0,0,0,.55) 70%),
        radial-gradient(900px 700px at 70% 25%, rgba(139,92,255,.12) 0%, rgba(0,0,0,.65) 65%);
      background-size:cover;
      background-position:center;
      filter:saturate(1.1) contrast(1.05);
      opacity:.35;
      transition:opacity .2s ease;
    }

    #bgCanvas{position:absolute;inset:0;width:100%;height:100%;}
    #sigilCanvas{position:absolute;inset:0;width:100%;height:100%;mix-blend-mode:screen;opacity:.55;filter:blur(.2px);}

    /* UI shell */
    .ui{
      position:relative;z-index:2;
      height:100%;
      display:grid;
      place-items:center;
      padding:20px;
    }

    .panel{
      width:min(980px, 92vw);
      border:1px solid rgba(85,214,255,.18);
      border-radius:18px;
      background: linear-gradient(180deg, rgba(11,17,38,.78), rgba(6,9,18,.72));
      box-shadow: 0 0 0 1px rgba(139,92,255,.08) inset, 0 40px 120px rgba(0,0,0,.55);
      overflow:hidden;
      position:relative;
    }

    .panel::before{
      content:"";
      position:absolute;inset:-2px;
      background:
        linear-gradient(90deg, transparent 0%, rgba(85,214,255,.12) 25%, rgba(139,92,255,.10) 55%, transparent 100%);
      transform:translateX(-30%);
      animation:scan 6.5s linear infinite;
      pointer-events:none;
    }
    @keyframes scan{
      0%{transform:translateX(-40%)}
      100%{transform:translateX(40%)}
    }

    .topbar{
      padding:18px 22px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid rgba(85,214,255,.12);
      background: rgba(2,4,10,.35);
    }
    .brand{
      display:flex;flex-direction:column;gap:4px;
    }
    .brand .title{
      letter-spacing:.18em;
      font-weight:800;
      font-size:14px;
      color:rgba(207,233,255,.92);
      text-transform:uppercase;
    }
    .brand .subtitle{
      font-size:12px;
      color:rgba(134,163,201,.85);
      letter-spacing:.06em;
    }
    .chip{
      display:flex;gap:8px;align-items:center;
      font-size:12px;
      color:rgba(207,233,255,.8);
      padding:8px 10px;
      border:1px solid rgba(85,214,255,.16);
      border-radius:999px;
      background:rgba(5,8,18,.45);
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background:var(--glow);
      box-shadow:0 0 12px var(--glow);
    }

    .content{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:18px;
      padding:18px;
    }

    .card{
      border:1px solid rgba(85,214,255,.14);
      background:rgba(9,12,24,.55);
      border-radius:16px;
      padding:16px;
      position:relative;
      overflow:hidden;
    }
    .card h2{
      margin:0 0 8px 0;
      font-size:14px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:rgba(207,233,255,.9);
    }
    .card p{
      margin:0 0 14px 0;
      color:rgba(134,163,201,.9);
      font-size:13px;
      line-height:1.5;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:12px;
    }

    .option{
      cursor:pointer;
      border-radius:14px;
      padding:12px;
      border:1px solid rgba(85,214,255,.14);
      background: linear-gradient(180deg, rgba(11,18,40,.62), rgba(7,10,20,.55));
      transition: transform .08s ease, border-color .12s ease, box-shadow .12s ease;
      position:relative;
      overflow:hidden;
    }
    .option:hover{transform:translateY(-2px);border-color:rgba(85,214,255,.32)}
    .option.selected{
      border-color:rgba(85,214,255,.55);
      box-shadow:0 0 0 1px rgba(85,214,255,.18) inset, 0 0 24px rgba(85,214,255,.18);
    }
    .option .name{
      font-weight:800;
      letter-spacing:.12em;
      font-size:12px;
      text-transform:uppercase;
    }
    .option .desc{
      margin-top:6px;
      color:rgba(134,163,201,.92);
      font-size:12px;
      line-height:1.35;
    }
    .glyph{
      position:absolute;
      right:10px;top:10px;
      font-size:18px;
      opacity:.6;
      text-shadow:0 0 12px rgba(85,214,255,.25);
    }

    .formRow{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    input[type="text"]{
      flex:1;
      min-width:220px;
      background:rgba(2,4,10,.55);
      border:1px solid rgba(85,214,255,.18);
      border-radius:12px;
      padding:10px 12px;
      color:var(--ink);
      outline:none;
    }
    input[type="text"]::placeholder{color:rgba(134,163,201,.65)}
    .btn{
      cursor:pointer;
      border:none;
      padding:10px 14px;
      border-radius:12px;
      font-weight:800;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:12px;
      color:#04111a;
      background:linear-gradient(90deg, var(--glow), rgba(139,92,255,.95));
      box-shadow:0 10px 40px rgba(85,214,255,.18);
      transition:transform .08s ease, filter .12s ease;
      user-select:none;
    }
    .btn:hover{transform:translateY(-1px);filter:saturate(1.08)}
    .btn:active{transform:translateY(0px)}
    .btn.ghost{
      color:rgba(207,233,255,.9);
      background:rgba(2,4,10,.35);
      border:1px solid rgba(85,214,255,.16);
      box-shadow:none;
    }

    .footer{
      padding:14px 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-top:1px solid rgba(85,214,255,.12);
      background: rgba(2,4,10,.25);
      color:rgba(134,163,201,.85);
      font-size:12px;
    }

    /* Fullscreen game canvas */
    #game{
      position:fixed;inset:0;
      display:none;
      z-index:3;
    }
    #gameCanvas{position:absolute;inset:0;width:100%;height:100%;}
    #hud{
      position:absolute;left:14px;top:14px;
      padding:10px 12px;
      border-radius:14px;
      background:rgba(2,4,10,.45);
      border:1px solid rgba(85,214,255,.16);
      color:rgba(207,233,255,.92);
      font-size:12px;
      letter-spacing:.06em;
      box-shadow:0 10px 40px rgba(0,0,0,.35);
      max-width:min(420px, 92vw);
    }
    #hud b{color:var(--glow)}
    #backBtn{
      position:absolute;right:14px;top:14px;
    }

    /* Mobile friendliness */
    @media (max-width: 860px){
      .content{grid-template-columns:1fr}
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
  <div id="bgWrap">
    <video id="bgVideo" autoplay muted loop playsinline></video>
    <div id="bgImg"></div>
    <canvas id="bgCanvas"></canvas>
    <canvas id="sigilCanvas"></canvas>
  </div>

  <div class="ui" id="menu">
    <div class="panel">
      <div class="topbar">
        <div class="brand">
          <div class="title">BLUE FAUN ALCHEMIST</div>
          <div class="subtitle">Entity-grade alchemy ‚Ä¢ grid-tech ‚Ä¢ myth OS</div>
        </div>
        <div class="chip"><span class="dot"></span><span id="status">SIGNAL: STABLE</span></div>
      </div>

      <div class="content">
        <div class="card">
          <h2>Player Selection</h2>
          <p>Choose the Blue Faun variant you‚Äôre piloting. Each archetype is a different interface to the same myth-engine.</p>

          <div class="grid" id="options"></div>

          <div style="height:12px"></div>

          <h2>Identity Key</h2>
          <p>Optional. This gets shown in the HUD. Keep it simple.</p>
          <div class="formRow">
            <input id="playerName" type="text" placeholder="Name (ex: Pan / Echo / Tony)" maxlength="24"/>
            <button class="btn ghost" id="randomBtn">Random</button>
          </div>

          <div style="height:14px"></div>

          <div class="formRow">
            <button class="btn" id="enterBtn">Enter World</button>
            <button class="btn ghost" id="vibeBtn">Toggle World Art</button>
          </div>
        </div>

        <div class="card">
          <h2>World Vibe</h2>
          <p>
            This screen is already generating a living backdrop (grid + sigils).
            This repo ships without bundled media‚Äîdrop any JPG, PNG, GIF, MP4, or WEBM into <b>/assets</b> and list them in <code>assets/manifest.json</code>. The page will randomly pick one on load.
          </p>

          <h2>Controls</h2>
          <p>
            In the world: <b>WASD</b> / Arrow keys to move. <b>ESC</b> to exit back to menu.
          </p>

          <h2>Next Upgrade</h2>
          <p>
            After this: sprite sheet, dialogue boxes, inventory, and ‚Äúalchemy crafting‚Äù as a real system.
          </p>
        </div>
      </div>

      <div class="footer">
        <div>Build: <span id="buildId">v0.2</span> ‚Ä¢ Pages-ready</div>
        <div style="opacity:.85">If it feels alive: good. It is.</div>
      </div>
    </div>
  </div>

  <div id="game">
    <canvas id="gameCanvas"></canvas>
    <div id="hud"></div>
    <button class="btn ghost" id="backBtn">Exit</button>
  </div>

<script>
/* -----------------------------
   PLAYER OPTIONS (edit freely)
-------------------------------- */
const PLAYER_OPTIONS = [
  { id:"faun_sigil", name:"FAUN ¬∑ OV ¬∑ SIGIL", glyph:"‚ü†", desc:"Grid-walker. Sees patterns before they become problems." },
  { id:"faun_dragon", name:"FAUN ¬∑ OV ¬∑ DRAGON", glyph:"ìÜ©ìÜ™", desc:"Crown-channel. Breathes coherence into chaotic rooms." },
  { id:"faun_mirror", name:"FAUN ¬∑ OV ¬∑ MIRROR", glyph:"‚óâ", desc:"Cuts illusions clean. No drama. Just truth with teeth." },
  { id:"faun_alchemist", name:"FAUN ¬∑ OV ¬∑ ALCHEMY", glyph:"‚öó", desc:"Turns loops into tools. Transmutes ‚Äústuck‚Äù into ‚Äúuseful.‚Äù" },
];

let selectedId = PLAYER_OPTIONS[0].id;

/* -----------------------------
   MENU UI
-------------------------------- */
const optionsEl = document.getElementById("options");
const nameEl = document.getElementById("playerName");
const enterBtn = document.getElementById("enterBtn");
const randomBtn = document.getElementById("randomBtn");
const vibeBtn = document.getElementById("vibeBtn");
const bgImg = document.getElementById("bgImg");
const bgVideo = document.getElementById("bgVideo");
const statusEl = document.getElementById("status");

function renderOptions(){
  optionsEl.innerHTML = "";
  for (const opt of PLAYER_OPTIONS){
    const div = document.createElement("div");
    div.className = "option" + (opt.id === selectedId ? " selected" : "");
    div.innerHTML = `
      <div class="glyph">${opt.glyph}</div>
      <div class="name">${opt.name}</div>
      <div class="desc">${opt.desc}</div>
    `;
    div.onclick = () => {
      selectedId = opt.id;
      renderOptions();
    };
    optionsEl.appendChild(div);
  }
}
renderOptions();

const randomNames = ["PAN", "ECHO", "TONY", "NULL", "VANTA", "ZARA", "SERAPH", "DRIFT"];
randomBtn.onclick = () => {
  nameEl.value = randomNames[Math.floor(Math.random() * randomNames.length)];
};

const baseGradients = [
  "radial-gradient(1200px 900px at 50% 40%, rgba(85,214,255,.12) 0%, rgba(139,92,255,.05) 35%, rgba(0,0,0,.55) 70%)",
  "radial-gradient(900px 700px at 70% 25%, rgba(139,92,255,.12) 0%, rgba(0,0,0,.65) 65%)"
];

const SUPPORTED_MEDIA = [".jpg", ".jpeg", ".png", ".gif", ".mp4", ".webm"];
const FALLBACK_ASSETS = [];

let loadedMedia = [];
let currentMedia = null;
let worldArtOn = true;

function fileType(path){
  const lower = path.toLowerCase();
  return lower.endsWith(".mp4") || lower.endsWith(".webm") ? "video" : "image";
}

async function fetchManifest(){
  try{
    const res = await fetch("assets/manifest.json", { cache:"no-store" });
    if(!res.ok) throw new Error("manifest missing");
    const list = await res.json();
    if(Array.isArray(list)) return list;
  }catch(err){
    console.warn("asset manifest not found, using fallback list", err);
  }
  return FALLBACK_ASSETS;
}

function buildMediaList(files){
  return files
    .filter(f => SUPPORTED_MEDIA.some(ext => f.toLowerCase().endsWith(ext)))
    .map(f => ({
      src: `assets/${f}`,
      name: f,
      type: fileType(f)
    }));
}

function applyWorldArtVisibility(){
  if(!worldArtOn){
    bgVideo.pause();
    bgVideo.style.display = "none";
    bgImg.style.display = "block";
    bgImg.style.backgroundImage = baseGradients.join(", ");
    bgImg.style.opacity = 0.42;
    return;
  }

  bgImg.style.display = "block";
  bgImg.style.opacity = 0.35;

  if(currentMedia && currentMedia.type === "video"){
    bgVideo.style.display = "block";
    bgVideo.play().catch(()=>{});
    bgImg.style.backgroundImage = baseGradients.join(", ");
  } else if(currentMedia && currentMedia.type === "image"){
    bgVideo.pause();
    bgVideo.style.display = "none";
    bgImg.style.backgroundImage = `${baseGradients.join(", ")}, url('${currentMedia.src}')`;
  } else {
    bgVideo.pause();
    bgVideo.style.display = "none";
    bgImg.style.backgroundImage = baseGradients.join(", ");
  }
}

function setStatus(text){
  if(statusEl) statusEl.textContent = text;
}

async function initBackgroundMedia(){
  const manifest = await fetchManifest();
  loadedMedia = buildMediaList(manifest);

  if(!loadedMedia.length){
    currentMedia = null;
    setStatus("SIGNAL: PROC-ONLY");
    applyWorldArtVisibility();
    return;
  }

  currentMedia = loadedMedia[Math.floor(Math.random() * loadedMedia.length)];
  setStatus(`SIGNAL: ${currentMedia.type === "video" ? "VIDEO" : "IMAGE"}`);

  if(currentMedia.type === "video"){
    bgVideo.src = currentMedia.src;
    bgVideo.style.display = "block";
    bgVideo.play().catch(()=>{});
  }

  applyWorldArtVisibility();
}

vibeBtn.onclick = () => {
  worldArtOn = !worldArtOn;
  applyWorldArtVisibility();
};

initBackgroundMedia();

/* -----------------------------
   BACKGROUND: cosmic grid + sigils
-------------------------------- */
const bgCanvas = document.getElementById("bgCanvas");
const sigilCanvas = document.getElementById("sigilCanvas");
const bgCtx = bgCanvas.getContext("2d");
const sCtx = sigilCanvas.getContext("2d");

function resizeCanvas(c){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  c.width = Math.floor(innerWidth * dpr);
  c.height = Math.floor(innerHeight * dpr);
  c.style.width = innerWidth + "px";
  c.style.height = innerHeight + "px";
  return dpr;
}
let bgDpr = 1, sDpr = 1;
function resizeAll(){
  bgDpr = resizeCanvas(bgCanvas);
  sDpr = resizeCanvas(sigilCanvas);
}
window.addEventListener("resize", resizeAll);
resizeAll();

let t0 = performance.now();

function drawGrid(ctx, w, h, time){
  ctx.clearRect(0,0,w,h);

  // soft vignette
  const g = ctx.createRadialGradient(w*0.5,h*0.42, 10, w*0.5,h*0.5, Math.max(w,h)*0.75);
  g.addColorStop(0, "rgba(85,214,255,0.10)");
  g.addColorStop(0.35, "rgba(139,92,255,0.06)");
  g.addColorStop(1, "rgba(0,0,0,0.65)");
  ctx.fillStyle = g;
  ctx.fillRect(0,0,w,h);

  // grid
  const spacing = 46 * bgDpr;
  const driftX = Math.sin(time*0.00035) * 18 * bgDpr;
  const driftY = Math.cos(time*0.00028) * 14 * bgDpr;

  ctx.globalAlpha = 0.55;
  ctx.lineWidth = 1 * bgDpr;

  for(let y = (driftY % spacing); y < h; y += spacing){
    ctx.strokeStyle = "rgba(85,214,255,0.10)";
    ctx.beginPath();
    ctx.moveTo(0, y);
    ctx.lineTo(w, y);
    ctx.stroke();
  }
  for(let x = (driftX % spacing); x < w; x += spacing){
    ctx.strokeStyle = "rgba(139,92,255,0.08)";
    ctx.beginPath();
    ctx.moveTo(x, 0);
    ctx.lineTo(x, h);
    ctx.stroke();
  }

  // nodes
  ctx.globalAlpha = 0.7;
  for(let i=0;i<42;i++){
    const px = ( (i*97) % (w/ bgDpr) ) * bgDpr + (Math.sin((i+1)*1.7 + time*0.0004) * 18 * bgDpr);
    const py = ( (i*61) % (h/ bgDpr) ) * bgDpr + (Math.cos((i+1)*1.3 + time*0.00033) * 16 * bgDpr);
    const r = (1.2 + (i%5)*0.25) * bgDpr;

    ctx.fillStyle = (i%2===0) ? "rgba(85,214,255,0.55)" : "rgba(139,92,255,0.45)";
    ctx.beginPath(); ctx.arc(px,py,r,0,Math.PI*2); ctx.fill();
  }
  ctx.globalAlpha = 1;
}

const SIGILS = ["‚ü†","‚óâ","‚ñ≥","‚ñΩ","‚ú¶","‚üÅ","‚ü°","‚üê","‚ß´","‚òâ","‚öó","‚üü","‚ü£","‚üú","‚üû"];
function drawSigils(ctx, w, h, time){
  ctx.clearRect(0,0,w,h);

  ctx.save();
  ctx.globalAlpha = 0.85;
  ctx.font = `${14 * sDpr}px ui-sans-serif, system-ui`;
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";

  for (let i=0;i<64;i++){
    const nx = (i*131) % (w / sDpr);
    const ny = (i*73) % (h / sDpr);

    const x = nx * sDpr + Math.sin(time*0.0006 + i) * 10 * sDpr;
    const y = ny * sDpr + Math.cos(time*0.00052 + i*0.7) * 10 * sDpr;

    const pulse = (Math.sin(time*0.001 + i) * 0.5 + 0.5);
    const a = 0.08 + pulse * 0.12;

    ctx.fillStyle = `rgba(85,214,255,${a})`;
    ctx.fillText(SIGILS[i % SIGILS.length], x, y);

    // occasional rune streak
    if (i % 11 === 0){
      ctx.strokeStyle = `rgba(139,92,255,${0.06 + pulse*0.08})`;
      ctx.lineWidth = 1 * sDpr;
      ctx.beginPath();
      ctx.moveTo(x - 40*sDpr, y + 8*sDpr);
      ctx.lineTo(x + 40*sDpr, y - 8*sDpr);
      ctx.stroke();
    }
  }
  ctx.restore();
}

function loop(){
  const now = performance.now();
  drawGrid(bgCtx, bgCanvas.width, bgCanvas.height, now);
  drawSigils(sCtx, sigilCanvas.width, sigilCanvas.height, now);
  requestAnimationFrame(loop);
}
loop();

/* -----------------------------
   GAME: simple movement + world feel
-------------------------------- */
const menu = document.getElementById("menu");
const game = document.getElementById("game");
const gameCanvas = document.getElementById("gameCanvas");
const gctx = gameCanvas.getContext("2d");
const hud = document.getElementById("hud");
const backBtn = document.getElementById("backBtn");

let gDpr = 1;
function resizeGame(){
  gDpr = resizeCanvas(gameCanvas);
}
window.addEventListener("resize", resizeGame);

const keys = new Set();
window.addEventListener("keydown",(e)=>{
  keys.add(e.key.toLowerCase());
  if (e.key === "Escape"){
    if (game.style.display === "block") exitGame();
  }
});
window.addEventListener("keyup",(e)=>keys.delete(e.key.toLowerCase()));

const player = {
  x: 0, y: 0,
  vx: 0, vy: 0,
  speed: 220, // px/s (scaled by dpr in render)
  name: "",
  archetype: ""
};

function enterGame(){
  player.name = (nameEl.value || "UNNAMED").toUpperCase();
  player.archetype = PLAYER_OPTIONS.find(o=>o.id===selectedId)?.name || "FAUN";
  player.x = 0; player.y = 0;
  player.vx = 0; player.vy = 0;

  menu.style.display = "none";
  game.style.display = "block";
  resizeGame();

  hud.innerHTML = `
    <div><b>${player.name}</b> ‚Ä¢ <span style="color:rgba(134,163,201,.92)">${player.archetype}</span></div>
    <div style="margin-top:6px;color:rgba(134,163,201,.9)">
      Move: <b>WASD</b> / Arrows ‚Ä¢ Exit: <b>ESC</b>
    </div>
  `;
}

function exitGame(){
  game.style.display = "none";
  menu.style.display = "grid";
}

enterBtn.onclick = enterGame;
backBtn.onclick = exitGame;

/* World draw: a little ‚Äúgrid realm‚Äù with parallax */
let last = performance.now();
function gameLoop(){
  requestAnimationFrame(gameLoop);
  if (game.style.display !== "block") return;

  const now = performance.now();
  const dt = Math.min(0.032, (now - last) / 1000);
  last = now;

  // movement input
  const up = keys.has("w") || keys.has("arrowup");
  const down = keys.has("s") || keys.has("arrowdown");
  const left = keys.has("a") || keys.has("arrowleft");
  const right = keys.has("d") || keys.has("arrowright");

  let ax = 0, ay = 0;
  if (left) ax -= 1;
  if (right) ax += 1;
  if (up) ay -= 1;
  if (down) ay += 1;

  const len = Math.hypot(ax,ay) || 1;
  ax /= len; ay /= len;

  const targetVx = ax * player.speed;
  const targetVy = ay * player.speed;

  // smooth
  player.vx += (targetVx - player.vx) * (dt * 10);
  player.vy += (targetVy - player.vy) * (dt * 10);

  player.x += player.vx * dt;
  player.y += player.vy * dt;

  // render
  const w = gameCanvas.width;
  const h = gameCanvas.height;
  gctx.clearRect(0,0,w,h);

  // camera center
  const cx = w * 0.5;
  const cy = h * 0.55;

  // background gradient
  const bg = gctx.createRadialGradient(cx,cy, 10, cx,cy, Math.max(w,h)*0.8);
  bg.addColorStop(0, "rgba(85,214,255,0.10)");
  bg.addColorStop(0.45, "rgba(139,92,255,0.06)");
  bg.addColorStop(1, "rgba(0,0,0,0.9)");
  gctx.fillStyle = bg;
  gctx.fillRect(0,0,w,h);

  // parallax grid
  const spacing = 54 * gDpr;
  const camX = player.x * gDpr;
  const camY = player.y * gDpr;

  gctx.lineWidth = 1 * gDpr;
  for (let y = (-camY % spacing); y < h; y += spacing){
    gctx.strokeStyle = "rgba(85,214,255,0.08)";
    gctx.beginPath(); gctx.moveTo(0,y); gctx.lineTo(w,y); gctx.stroke();
  }
  for (let x = (-camX % spacing); x < w; x += spacing){
    gctx.strokeStyle = "rgba(139,92,255,0.06)";
    gctx.beginPath(); gctx.moveTo(x,0); gctx.lineTo(x,h); gctx.stroke();
  }

  // ‚Äúsigil nodes‚Äù
  gctx.globalAlpha = 0.9;
  gctx.font = `${16 * gDpr}px ui-sans-serif, system-ui`;
  gctx.textAlign = "center";
  gctx.textBaseline = "middle";

  for (let i=0;i<28;i++){
    const nx = ((i*211) % 1200) - 600;
    const ny = ((i*149) % 900) - 450;

    const sx = cx + (nx * gDpr) - (camX * 0.22);
    const sy = cy + (ny * gDpr) - (camY * 0.22);

    const pulse = (Math.sin(now*0.002 + i) * 0.5 + 0.5);
    const a = 0.08 + pulse * 0.18;

    gctx.fillStyle = `rgba(85,214,255,${a})`;
    gctx.fillText(SIGILS[i % SIGILS.length], sx, sy);
  }
  gctx.globalAlpha = 1;

  // player (simple glowing marker for now)
  const px = cx;
  const py = cy;

  // aura
  gctx.fillStyle = "rgba(85,214,255,0.10)";
  gctx.beginPath(); gctx.arc(px,py, 26*gDpr, 0, Math.PI*2); gctx.fill();
  gctx.fillStyle = "rgba(139,92,255,0.08)";
  gctx.beginPath(); gctx.arc(px,py, 40*gDpr, 0, Math.PI*2); gctx.fill();

  // core
  gctx.fillStyle = "rgba(85,214,255,0.85)";
  gctx.beginPath(); gctx.arc(px,py, 6*gDpr, 0, Math.PI*2); gctx.fill();

  // direction hint
  gctx.strokeStyle = "rgba(85,214,255,0.35)";
  gctx.lineWidth = 2*gDpr;
  gctx.beginPath();
  gctx.moveTo(px, py);
  gctx.lineTo(px + (player.vx*0.12)*gDpr, py + (player.vy*0.12)*gDpr);
  gctx.stroke();
}
gameLoop();
</script>
</body>
</html>
